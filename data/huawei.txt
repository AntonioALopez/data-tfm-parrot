Conector Huawey NetEco

Se necesita hacer el conector para unas plantas de UK por medio de la API de NetEco de Huawey, explicamos cómo se haría:

Primero obtenemos el token:
Básicamente hacemos un llamado al endpoint del login:

Y de los headers de la respuesta tomamos el header llamado xsrf-token:



Y nos lo llevamos para trasladarlo como header de los siguientes llamados:



Luego hacemos el llamado al endpoint del histórico :


Pero aquí viene el problema, tiene muchas restricciones. Lo primero las fechas startTime y endTime son en unix (en formato milisegundos). 
Luego sólo se puede hacer 1 llamado por minuto
Sólo se pueden llamar máximo 10 dispositivos de 1 mismo tipo a la vez
El máximo de tiempo que se permite llamar es de 3 días.
Luego hay un máximo de llamados diarios pero creo que lo cubrimos bien.
Adjunto voy a poner la documentación (esto está en la sección 9.1.6.2 Historical Device Data Interface) pero igual pongo imágenes de referencia de las restricciones:





Así que tomando esto en cuenta el propio agente tiene que manejar los llamados tomando en cuenta las restricciones :
Tendrá que esperar 1 minutos (yo diría unos segundos más por si acaso) entre llamado y llamado
Tendrá que dividir el total de alias de dispositivos que se filtren en la tarea de 10 en 10 máximo
Si el tiempo que se consulta es superior a 3 días deberá dividir el rango con 3 días máximo

Ahora del funcionamiento del endpoint como tal es bastante sencillo:




La respuesta del Json tiene un atributo “Data” de donde sacan la información requerida. Dentro de “Data” hay un array de registros con:
devId -> de aquí sacan el Alias
collectTime -> de aquí la fecha del registro
Dentro de “dataItemMap” tienen las propiedades con sus valores. El nombre de las propiedades lo toman tal cual lo diga la respuesta. Los valores nulos parece que los devuelven con null así que no creo haya mucho problema con eso.

Pues eso creo que sería todo. Lo importante es que el agente maneje los tiempos y los seccionadores de dispositivos y de fechas que se han indicado.
Anexo a la User Story encontrarán la documentación de la API si la necesitan y también la colección de Postman para probar.